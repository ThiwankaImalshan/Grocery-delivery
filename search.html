<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrocGo</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
</head>
<body>

    <!-- Navigation Bar/Header -->
    <header>
        <div class="header-navbar-checkout">
            <div class="navbar-row">
                <div class="navbar-logo">
                    <h2>GrocGo</h2>
                </div>
                <div class="navbar-items">
                    <ul>
                        <h3><a href="/index.html">Home</a></h3>
                        <h3><a href="/product.html">Products</a></h3>
                        <h3><a href="/services.html">Services</a></h3>
                        <h3><a href="/about.html">About Us</a></h3>
                        <div class="navbar-cart">
                            <small>Add to Cart</small>
                            <i class="fa fa-shopping-cart" aria-hidden="true">
                                <span id="smart-checkout-count" class="badge">0</span>
                            </i>
                        </div>
                        <div class="navbar-signin">
                            <i class="fa fa-user-circle-o" aria-hidden="true"></i>
                        </div>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Cart-Tab -->
        <div class="cartTab">
            <h1>Shopping Cart</h1>
            <div class="listCart">

            </div>
            <div class="cartTab-btn">
                <button class="cartTab-close">Close</button>
                <button class="cartTab-checkOut" onclick="document.location='checkout.html'">Check Out</button>
            </div>
        </div>
    </header>

    <div class="promotion-img">
        <img src="/promotion img/Slide3.gif" width="100%" alt="">
    </div>

    <div class="search-body">
        <div class="search-left-section">
            <div class="search-now">
                <h3>Search Now</h3>
                <div class="search-now-bar">
                    <input type="text" name="" id="searchInput" placeholder="Search products..." oninput="suggestProducts()">
                    <button class="search-now-btn" onclick="searchProducts()">
                        <i class="fa fa-search"></i>
                    </button>
                    <ul id="searchResults"></ul>
                </div>
                <div class="filter-bar">
                    <h3>Filter By</h3>
                    <div class="filter-box">
                        <input class="range-bar" type="range" id="price" name="price" oninput="filterByPrice()" min="500" max="10000" step="1" value="500" onchange="updatePrice(this.value)">
                        <p><span>Rs.100</span> - <span id="price-display"></span></p>
                    </div>
                </div>
                <!-- <div class="categories-bar">
                    <h3>Categories</h3>
                    <div class="categories-box">

                    </div>
                </div> -->
            </div>
        </div>
        <div class="search-right-section">
            <div class="searching-result">
                <!-- <select id="sortSelect" onchange="filterAndSort()">
                    <option value="priceLowToHigh">Price Low to High</option>
                    <option value="priceHighToLow">Price High to Low</option>
                    <option value="nameAToZ">Name A to Z</option>
                    <option value="nameZToA">Name Z to A</option>
                </select> -->
            </div>
            
            <div class="row-body" id="results"></div>
            <!-- Card Row -->
            <!-- <div class="row-body">
                <ul>
                    <div class="row-card">
                        <div class="row-card-img">
                            <img src="product img/apple.jpg" alt="Product 1">
                        </div>
                        <div class="row-txt">
                            <h3>Fresh Apple</h3>
                            <h4>In Stock</h4>
                            <button class="btn-addtocart">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                    <div class="row-card">
                        <div class="row-card-img">
                            <img src="product img/snickers.jpg" alt="Product 2">
                        </div>
                        <div class="row-txt">
                            <h3>Snickers</h3>
                            <h4>In Stock</h4>
                            <button class="btn-addtocart">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                    <div class="row-card">
                        <div class="row-card-img">
                            <img src="product img/Orange juice.jpg" alt="Product 4">
                        </div>
                        <div class="row-txt">
                            <h3>Fresh Orange juice</h3>
                            <h4>In Stock</h4>
                            <button class="btn-addtocart">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </ul>
            </div> -->

            <!-- Card Row -->
            <!-- <div class="row-body">
                <ul>
                    <div class="row-card">
                        <div class="row-card-img">
                            <img src="product img/snickers.jpg" alt="Product 2">
                        </div>
                        <div class="row-txt">
                            <h3>Snickers</h3>
                            <h4>In Stock</h4>
                            <button class="btn-addtocart">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                    <div class="row-card">
                        <div class="row-card-img">
                            <img src="product img/Almond.jpg" alt="Product 3">
                        </div>
                        <div class="row-txt">
                            <h3>Almonds</h3>
                            <h4>In Stock</h4>
                            <button class="btn-addtocart">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                    <div class="row-card">
                        <div class="row-card-img">
                            <img src="product img/Orange juice.jpg" alt="Product 4">
                        </div>
                        <div class="row-txt">
                            <h3>Fresh Orange juice</h3>
                            <h4>In Stock</h4>
                            <button class="btn-addtocart">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </ul>
            </div> -->

        </div>
    </div>



    <!-- Footer Section -->
    <footer>
        <div class="footer-container">
            <img src="img/footer-bg.png" alt="Footer Background">
            <div class="footer-content">
                <div class="footer-content-sec1">
                    <div class="footer-sec footer-sec1">
                        <h3>GrocGo</h3><br>
                        <p>Copyright Â© 2024 GrocGo  LK (PVT) Ltd. </p>
                        <p>All Rights Reserved</p>
                        <p>Designed & Developed by .......................</p>
                    </div>
                </div>
                <div class="footer-content-sec2">
                    <div class="footer-sec footer-sec2">
                        <h3>Customer Care</h3><br>
                        <p><a href="/about.html">About US</a></p>
                        <p><a href="/services.html">Services</a></p>
                        <p><a href="">Privacy Policy</a></p>
                    </div>
                    <div class="footer-sec footer-sec3">
                        <h3>Contact Us</h3><br>
                        <p><a href="tel:+9471234567"><i class="fa fa-phone" aria-hidden="true"></i>&nbsp;&nbsp;+9471234567</a></p>
                        <p><a href="https://maps.app.goo.gl/iZKTKozdvHXE7WxQ9"><i class="fa fa-map-marker" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Waidya Road, Dehiwala</a></p>
                        <p><a href="mailto: grocgo@gmail.com"><i class="fa fa-envelope" aria-hidden="true"></i>&nbsp;&nbsp;grocgo@gmail.com</a></p>
                    </div>
                </div>
            </div>
        </div>
    </footer> 

<script>
    //-----------range bar price changement display---------
    function updatePrice(val) {
        document.getElementById('price-display').textContent = 'Rs.' + val;
    }


    //-----------range-input level up to maximum------------
    const rangeInput = document.getElementById('price');
    rangeInput.value = rangeInput.max;

    

    //--------------display product result----------------
    function displayProducts(results) {
    const searchInput = document.getElementById('searchInput').value.toLowerCase();
    const resultsContainer = document.getElementById('results');
    // Clear previous results
    resultsContainer.innerHTML = '';
    // Filter products based on search input
    const filteredResults = results.filter(product => product.name.toLowerCase().includes(searchInput));
    
    let productCounter = 0;
    let ul; // Initialize ul variable
    resultsContainer.appendChild(document.createElement('div')); // Create a wrapper for rows
    // Display each result
    filteredResults.forEach(product => {
        if (productCounter % 3 === 0) {
            // Create a new row every 3 products
            ul = document.createElement('ul');
            ul.classList.add('search-row');
            resultsContainer.lastElementChild.appendChild(ul);
        }

        const rowCard = document.createElement('div');
        rowCard.classList.add('row-card');

        const rowCardImg = document.createElement('div');
        rowCardImg.classList.add('row-card-img');
        rowCard.appendChild(rowCardImg);

        const image = document.createElement('img');
        image.src = product.image;
        image.alt = product.name;
        rowCardImg.appendChild(image);

        const rowTxt = document.createElement('div');
        rowTxt.classList.add('row-txt');
        rowCard.appendChild(rowTxt);

        const name = document.createElement('h3');
        name.textContent = product.name;
        rowTxt.appendChild(name);

        const head4 = document.createElement('h4');
        head4.textContent = 'Rs.' + product.price;
        rowTxt.appendChild(head4);

        const button = document.createElement('button');
        button.classList.add('btn-addtocart');
        button.textContent = 'Add to Cart';
        rowTxt.appendChild(button);

        ul.appendChild(rowCard);

        // Apply availability check and styling to the buttons
        if (product.availability === 'out of stock') {
            button.style.backgroundColor = '#DE3163';
            button.style.color = 'white';
            button.textContent = "Out of Stock";
            button.style.pointerEvents = 'none';
            button.disabled = true;
        } else {
            button.style.backgroundColor = ''; // Use default stylesheet color
            button.disabled = false;
        }

        productCounter++;
        
    });

    // If no results found
    if (filteredResults.length === 0) {
        const noResultsMessage = document.createElement('p');
        noResultsMessage.textContent = 'No products found matching your search...';
        noResultsMessage.classList.add('no-result-message');
        resultsContainer.appendChild(noResultsMessage);
    }

}


    //----------fetch data---------
    let searchData; // Variable to store fetched data

        function fetchProducts() {
            return fetch('category.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    searchData = data;
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        //---------------search products-----------
        function searchProducts() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = searchData.categories.flatMap(category =>
                category.subcategories.flatMap(subcategory =>
                    subcategory.products.filter(product =>
                        product.name.toLowerCase().includes(searchInput)
                    )
                )
            );
            displayProducts(filteredData);
        }

        //----------------filter by price------------------
        function filterByPrice() {
            const maxPrice = document.getElementById('price').value;
            const filteredData = searchData.categories.flatMap(category =>
                category.subcategories.flatMap(subcategory =>
                    subcategory.products.filter(product =>
                        product.price <= maxPrice
                    )
                )
            );
            displayProducts(filteredData);
        }



        //------------Fetch products data when the page loads------------
        fetchProducts().then(() => {
            // Display all products initially
            displayProducts(searchData.categories.flatMap(category =>
                category.subcategories.flatMap(subcategory => subcategory.products)
            ));
        });




        //------------------Cart window--------------------
        let naviCart = document.querySelector('.navbar-cart');
        let bodyCon = document.querySelector('body');
        let closetheCart = document.querySelector('.cartTab-close');
        // Show Cart
        naviCart.addEventListener('click', () => {
            bodyCon.classList.toggle('showCart');
        })

        // Close Cart
        closetheCart.addEventListener('click', () => {
            bodyCon.classList.toggle('showCart');
        })









        //-------------Display search get from index.html--------------
        window.onload = function() {
            // Retrieve search input from query parameter
            const urlParams = new URLSearchParams(window.location.search);
            const searchInput = urlParams.get('searchInput');

            // Call performSearch() function after 3 seconds
            setTimeout(function() {
                if (searchInput) {
                    performSearch(searchInput);
                } else {
                    console.log("No search input provided.");
                }
            }, 0.01); // 3000 milliseconds = 3 seconds

        };

        function performSearch(searchInput) {
            // Convert search input to lowercase
            console.log(searchInput);
            searchInput = searchInput.toLowerCase();
            
            const filteredData = searchData.categories.flatMap(category =>
                category.subcategories.flatMap(subcategory =>
                    subcategory.products.filter(product =>
                        product.name.toLowerCase().includes(searchInput)
                    )
                )
            );

            // Assuming you have a function displayProducts() to display the filtered data
            displayProducts(filteredData);
        }







        //_______________________Cart for each pages_________________________

        //---------------Retrieve cart data from local storage on page load----------------
        let list__Cart = document.querySelector('.listCart');
        let navbar__cartSpan = document.querySelector('.navbar-cart span');

        window.addEventListener('load', () => {
            // Get cart data from local storage
            const cartData = JSON.parse(localStorage.getItem('cart'));
            // If cart data exists, assign it to cartBox array
            if (cartData && Array.isArray(cartData)) {
                cartBox = cartData;
            }
            console.log(cartBox);
            // Render cart items from local storage
            renderCartItemsFromLocalStorage();
        });

        // Function to render the cart items from local storage
        const renderCartItemsFromLocalStorage = () => {
            console.log("Rendering cart items from local storage...");
            console.log("Cart data from local storage:", cartBox);

            // Get outerArray data from local storage
            const outerItems = JSON.parse(localStorage.getItem('outerProductsArray'));
            
            list__Cart.innerHTML = '';
            let totalQuantity = 0;
            if (cartBox.length > 0) {
                cartBox.forEach(cartss => {
                    totalQuantity += cartss.quantity;
                    let newCart = document.createElement('div');
                    newCart.classList.add('listCart-items');
                    newCart.dataset.id = cartss.product_id;
                    let positionProduct = outerItems.findIndex((value) => value.id == cartss.product_id);
                    let info = outerItems[positionProduct];
                    newCart.innerHTML = `
                        <div class="listCart-image">
                            <img src="${info.image}">
                        </div>
                        <div class="listCart-name">
                            ${info.name}
                        </div>
                        <div class="listCart-totalPrice">Rs.${info.price * cartss.quantity}</div>
                        <div class="listCart-quantity">
                            <span class="listCart-minus"><</span>
                            <span>${cartss.quantity}</span>
                            <span class="listCart-plus">></span>
                        </div>
                    `;
                    list__Cart.appendChild(newCart);
                });
            }
            navbar__cartSpan.innerText = totalQuantity;
            console.log("Cart items rendered successfully.");
        };

</script>
<script src="script.js"></script>
<script src="product.js"></script>
</body>
</html>